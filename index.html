<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>InovAccion</title>

<style>
body{
    background: radial-gradient(circle,#2b0000,#000);
    font-family: Arial, sans-serif;
    color: gold;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}
.panel{
    width: 700px;
    border: 3px solid gold;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 0 30px gold;
}
h1{
    text-shadow: 0 0 12px gold;
    font-size: 36px;
}
h2{
    margin-top: 25px;
    text-shadow: 0 0 10px gold;
}
.fila{
    display: flex;
    gap: 10px;
    margin-top: 8px;
}
input, select{
    flex: 1;
    padding: 10px;
    border-radius: 10px;
    border: 2px solid gold;
    background: black;
    color: gold;
}
button{
    padding: 10px 18px;
    border-radius: 10px;
    font-weight: bold;
    border: none;
    cursor: pointer;
}
.rojo{
    background: red;
    color: white;
}
.azul{
    background: #0059ff;
    color: white;
}
ul{
    list-style: none;
    padding-left: 0;
}
li{
    border: 1px solid gold;
    margin-top: 6px;
    padding: 10px;
    border-radius: 8px;
}
.sub{
    margin-left: 20px;
    color: #00ffcc;
    font-size: 13px;
}
</style>
</head>

<body>

<div class="panel">

<h1>InovAccion</h1>

<div class="fila">
    <input id="tareaInput" placeholder="T√≠tulo de tarea">
    <button class="rojo" onclick="agregarInicio()">A√ëADIR INICIO</button>
    <button class="rojo" onclick="agregarFinal()">A√ëADIR FINAL</button>
</div>

<div class="fila">
    <button class="rojo" onclick="eliminarInicio()">ELIMINAR INICIO</button>
    <button class="rojo" onclick="eliminarFinal()">ELIMINAR FINAL</button>
</div>

<h2>Sub-Tareas</h2>

<div class="fila">
    <select id="tareaSelect"></select>
    <input id="subInput" placeholder="T√≠tulo de la sub-tarea">
    <button class="azul" onclick="agregarSub()">+ SUB-TAREA</button>
</div>

<h2>Buscar Tarea</h2>

<div class="fila">
    <input id="buscarInput" placeholder="ID o texto">
    <button class="rojo" onclick="buscar()">BUSCAR</button>
    <button class="rojo" onclick="limpiarBusqueda()">LIMPIAR</button>
</div>

<h2>√Årbol de Tareas</h2>
<ul id="lista"></ul>

</div>

<!-- Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
// üî• CORRECTA CONEXI√ìN A SUPABASE (variable db)
const db = supabase.createClient(
  "https://hpgyydcwnnxlgccrdsll.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhwZ3l5ZGN3bm54bGdjY3Jkc2xsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ4MTIwOTUsImV4cCI6MjA4MDM4ODA5NX0.eQ90r1awmyw8wZwvqKQcPu5cbOpCYb6YpzNTFpSn0ns"
);

let tareas = [];

// üî• CARGAR TAREAS DESDE SUPABASE
window.onload = async () => {
    let { data, error } = await db.from("tareas").select("*");
    if (!error) tareas = data;
    render();
};

// üî• AGREGAR TAREA AL INICIO
async function agregarInicio(){
    let txt = tareaInput.value.trim();
    if(txt === "") return;

    let { data } = await db.from("tareas").insert({
        titulo: txt,
        parent_id: null
    }).select();

    tareas.unshift(data[0]);
    tareaInput.value = "";
    render();
}

// üî• AGREGAR TAREA AL FINAL
async function agregarFinal(){
    let txt = tareaInput.value.trim();
    if(txt === "") return;

    let { data } = await db.from("tareas").insert({
        titulo: txt,
        parent_id: null
    }).select();

    tareas.push(data[0]);
    tareaInput.value = "";
    render();
}

// üî• ELIMINAR INICIO
async function eliminarInicio(){
    if(tareas.length === 0) return;

    let id = tareas[0].id;
    await db.from("tareas").delete().eq("id", id);

    tareas.shift();
    render();
}

// üî• ELIMINAR FINAL
async function eliminarFinal(){
    if(tareas.length === 0) return;

    let id = tareas[tareas.length - 1].id;
    await db.from("tareas").delete().eq("id", id);

    tareas.pop();
    render();
}

// üî• AGREGAR SUBTAREA
async function agregarSub(){
    let index = tareaSelect.value;
    let parent = tareas[index];
    let txt = subInput.value.trim();
    if(txt === "") return;

    let { data } = await db.from("tareas").insert({
        titulo: txt,
        parent_id: parent.id
    }).select();

    tareas.push(data[0]);
    subInput.value = "";
    render();
}

// üî• BUSCAR
function buscar(){
    let txt = buscarInput.value.trim().toLowerCase();
    lista.innerHTML = "";

    tareas.forEach(t => {
        if(t.id == txt || t.titulo.toLowerCase().includes(txt)){
            renderItem(t, true);
        }
    });
}

// üî• LIMPIAR
function limpiarBusqueda(){
    buscarInput.value = "";
    render();
}

// üî• RENDERIZACI√ìN GENERAL
function render(){
    lista.innerHTML = "";
    tareaSelect.innerHTML = "";

    let principales = tareas.filter(t => t.parent_id === null);

    principales.forEach(t => renderItem(t, false));
}

// üî• RENDER DE ITEM
function renderItem(t, highlight){
    let li = document.createElement("li");
    li.innerHTML = `${highlight ? "‚úÖ" : "üü°"} [${t.id}] ${t.titulo}`;

    let subtareas = tareas.filter(s => s.parent_id === t.id);

    subtareas.forEach(s => {
        let sub = document.createElement("div");
        sub.className = "sub";
        sub.textContent = "‚Ü≥ " + s.titulo;
        li.appendChild(sub);
    });

    lista.appendChild(li);

    let op = document.createElement("option");
    op.value = tareas.indexOf(t);
    op.textContent = t.titulo;
    tareaSelect.appendChild(op);
}
</script>

</body>
</html>
